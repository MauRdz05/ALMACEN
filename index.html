<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Inventario - Auxim</title>
</head>
<body>
  <h2 id="titulo">Cargando...</h2>
  <p><strong>Material:</strong> <span id="material"></span></p>
  <p><strong>Cantidad disponible:</strong> <span id="cantidad"></span></p>

  <label>Máquina / Persona:</label>
  <input id="maquina" placeholder="Ejemplo: WATMA o Juan Pérez">

  <label>Cantidad a restar:</label>
  <input id="resta" type="number" min="1">

  <button onclick="restar()">Restar</button>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const webAppUrl = "https://script.google.com/macros/s/AKfycbyHZqpvPxQet4XJGBgV21Pnb3x82etgjy08XvZSeyJMaCkDe_9kFAA5QkF6TBf7Yw8xPw/exec";
    // tu URL de Apps Script

    // Cargar material
    fetch(webAppUrl + "?id=" + id)
      .then(res => res.json())
      .then(data => {
        if (!data) {
          document.getElementById("titulo").innerText = "No encontrado";
          return;
        }
        document.getElementById("titulo").innerText = "Inventario";
        document.getElementById("material").innerText = data.material;
        document.getElementById("cantidad").innerText = data.cantidad;
        document.getElementById("resta").dataset.row = data.row;
      });

    // Restar material
    function restar() {
      const row = document.getElementById("resta").dataset.row;
      const amount = document.getElementById("resta").value;
      fetch(webAppUrl + "?row=" + row + "&amount=" + amount)
        .then(res => res.json())
        .then(resp => {
          alert("Cantidad actualizada: " + resp.previous + " → " + resp.now);
          document.getElementById("cantidad").innerText = resp.now;
          document.getElementById("resta").value = "";
        });
    }
  </script>
</body>
</html>


